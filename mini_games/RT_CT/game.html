<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìœ ë¬¼ ì‚¬ëƒ¥ê¾¼ê³¼ ì‹œê°„ì˜ ì €ì£¼</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo:wght@400;700&family=Cinzel+Decorative:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* --- ê¸°ë³¸ ìŠ¤íƒ€ì¼ --- */
        :root {
            --font-main: 'Nanum Myeongjo', serif;
            --font-title: 'Cinzel Decorative', cursive;
            --color-bg: #f5eadd; /* ì–‘í”¼ì§€ ë°°ê²½ */
            --color-text: #4a3f35; /* ì–´ë‘ìš´ ê°ˆìƒ‰ */
            --color-primary: #8c6b4f; /* ë‚˜ë¬´ìƒ‰ */
            --color-accent: #c8a672; /* ê¸ˆìƒ‰ */
            --color-relic: #a4c8a2; /* ìœ ë¬¼ ì¹´ë“œìƒ‰ */
            --color-curse: #d18c8c; /* ì €ì£¼ ì¹´ë“œìƒ‰ */
            --shadow: 3px 3px 8px rgba(0,0,0,0.2);
        }

        body {
            font-family: var(--font-main);
            color: var(--color-text);
            margin: 0;
            padding: 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            box-sizing: border-box;
            /* --- ë°°ê²½ ì´ë¯¸ì§€ ì„¤ì • --- */
            background-image: url('https://hobbyco.github.io/pds_root/mini_games/RT_CT/img/m_bg.png'); /* ëª¨ë°”ì¼ ë°°ê²½ ê²½ë¡œ */
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* ìŠ¤í¬ë¡¤ ì‹œ ë°°ê²½ ê³ ì • */
        }

        /* --- ê²Œì„ ì»¨í…Œì´ë„ˆ --- */
        #game-container {
            width: 100%;
            max-width: 800px;
            min-width: 320px;
            background-color: rgba(245, 234, 221, 0.65); /* ë°°ê²½ì´ ë¹„ì¹˜ë„ë¡ ë°˜íˆ¬ëª… ì²˜ë¦¬ (0.8 -> 0.65) */
            border: 2px solid var(--color-primary);
            border-radius: 15px;
            box-shadow: var(--shadow);
            padding: 20px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        /* --- í—¤ë” --- */
        header {
            text-align: center;
            border-bottom: 2px dashed var(--color-primary);
            padding-bottom: 10px;
        }

        header h1 {
            font-family: var(--font-title);
            font-size: 2.5rem;
            margin: 0;
            color: var(--color-primary);
            text-shadow: 1px 1px 2px var(--color-accent);
        }
        
        .mobile-break {
            display: none;
        }

        /* --- ì •ë³´ íŒ¨ë„ --- */
        #info-panel {
            display: flex;
            justify-content: space-around;
            background-color: rgba(255, 255, 255, 0.6); /* íˆ¬ëª…ë„ ì¡°ì ˆ (0.7 -> 0.6) */
            padding: 15px;
            border-radius: 10px;
            border: 1px solid var(--color-accent);
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-box {
            text-align: center;
            flex: 1;
            min-width: 120px;
        }

        .info-box h2 {
            margin: 0 0 5px 0;
            font-size: 1rem;
            color: var(--color-primary);
        }

        .info-box p {
            margin: 0;
            font-size: 1.5rem;
            font-weight: bold;
        }

        /* --- ê²Œì„ ë³´ë“œ --- */
        #game-board {
            display: flex;
            justify-content: space-between;
            gap: 20px;
            height: 220px;
        }

        .deck-area {
            flex: 1;
            border: 2px dashed var(--color-primary);
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background: rgba(0,0,0,0.05);
        }

        .deck-area h3 {
            margin: 0;
            position: absolute;
            top: 10px;
            font-size: 1rem;
        }

        .card-pile {
            width: 100px;
            height: 150px;
            border: 2px solid var(--color-primary);
            border-radius: 10px;
            background-color: var(--color-accent);
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 3rem;
            font-family: var(--font-title);
            color: white;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            transition: transform 0.2s;
            position: relative;
        }
        .card-pile:hover {
            transform: scale(1.05);
        }
        
        .card-pile::after {
            content: attr(data-count);
            position: absolute;
            bottom: -25px;
            font-size: 1rem;
            font-family: var(--font-main);
            color: var(--color-text);
            text-shadow: none;
        }

        #exploration-area {
            flex: 2;
            border: 2px solid var(--color-primary);
            border-radius: 10px;
            padding: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px; /* ì¹´ë“œ ê°„ê²© ì¡°ì • */
            align-content: flex-start;
            overflow-y: auto;
            background: rgba(255,255,255,0.2);
        }

        /* --- ì¹´ë“œ ìŠ¤íƒ€ì¼ --- */
        .card {
            width: 65px; /* ì¹´ë“œ ë„ˆë¹„ ì¡°ì • */
            height: 100px; /* ì¹´ë“œ ë†’ì´ ì¡°ì • */
            border-radius: 6px;
            padding: 4px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            align-items: center;
            text-align: center;
            font-size: 0.7rem; /* í°íŠ¸ í¬ê¸° ì¡°ì • */
            font-weight: bold;
            box-shadow: var(--shadow);
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            transition: transform 0.3s ease-in-out;
            animation: flipIn 0.5s ease-in-out;
        }

        .relic { background-color: var(--color-relic); }
        .curse { background-color: var(--color-curse); }

        .card .value {
            font-size: 1.2rem; /* ê°’ í°íŠ¸ í¬ê¸° ì¡°ì • */
            font-weight: bold;
        }
        
        @keyframes flipIn {
            from { transform: rotateY(90deg) scale(0.8); }
            to { transform: rotateY(0deg) scale(1); }
        }

        /* --- ë©”ì‹œì§€ ë° ì»¨íŠ¸ë¡¤ --- */
        #message-area {
            min-height: 40px;
            background-color: rgba(255, 255, 255, 0.6); /* íˆ¬ëª…ë„ ì¡°ì ˆ (0.7 -> 0.6) */
            border: 1px solid var(--color-accent);
            border-radius: 10px;
            padding: 10px;
            text-align: center;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #controls {
            display: flex;
            justify-content: center;
            gap: 20px;
        }

        .btn {
            padding: 12px 25px;
            font-family: var(--font-main);
            font-size: 1.2rem;
            font-weight: bold;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: var(--color-primary);
            color: white;
            box-shadow: var(--shadow);
            transition: all 0.2s;
        }

        .btn:hover:not(:disabled) {
            background-color: #6e533c;
            transform: translateY(-2px);
            box-shadow: 5px 5px 12px rgba(0,0,0,0.3);
        }

        .btn:disabled {
            background-color: #a8a8a8;
            cursor: not-allowed;
        }
        
        /* --- ëª¨ë‹¬ --- */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.6);
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background-color: var(--color-bg);
            padding: 30px;
            border: 3px solid var(--color-primary);
            border-radius: 15px;
            text-align: center;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.4);
            animation: modalOpen 0.4s ease-out;
        }

        .modal-content h2 {
            font-family: var(--font-title);
            font-size: 2rem;
            color: var(--color-primary);
        }
        
        .modal-content p {
            font-size: 1.2rem;
        }

        @keyframes modalOpen {
            from { transform: scale(0.7); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        
        /* ëª¨ë°”ì¼ í™”ë©´ ëŒ€ì‘ */
        @media (max-width: 767px) {
            header h1 {
                font-size: 1.8rem;
                line-height: 1.2;
            }
            .mobile-break {
                display: block;
            }
        }
        
        /* PC í™”ë©´ ëŒ€ì‘ */
        @media (min-width: 768px) {
            body {
                background-image: url('https://hobbyco.github.io/pds_root/mini_games/RT_CT/img/pc_bg.png'); /* PC ë°°ê²½ ê²½ë¡œ */
            }
        }
    </style>
</head>
<body>

    <div id="game-container">
        <header>
            <h1>ìœ ë¬¼ ì‚¬ëƒ¥ê¾¼ê³¼<br class="mobile-break"> ì‹œê°„ì˜ ì €ì£¼</h1>
        </header>

        <section id="info-panel">
            <div class="info-box">
                <h2>Best Score</h2>
                <p id="total-score">0</p>
            </div>
            <div class="info-box">
                <h2>ì´ë²ˆ íƒí—˜ ì ìˆ˜</h2>
                <p id="turn-score">0</p>
            </div>
            <div class="info-box">
                <h2>ì €ì£¼</h2>
                <p id="curse-level">0 / 5</p>
            </div>
        </section>

        <section id="game-board">
            <div class="deck-area">
                <h3>íƒí—˜ ë±</h3>
                <div id="deck-pile" class="card-pile" data-count="30">
                    <span>ğŸ’</span>
                </div>
            </div>
            <div id="exploration-area">
                <!-- ë½‘ì€ ì¹´ë“œë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
        </section>

        <section id="message-area">
            <p id="message-text">íƒí—˜ì„ ì‹œì‘í•˜ì„¸ìš”!</p>
        </section>

        <section id="controls">
            <button id="explore-btn" class="btn">íƒí—˜ ê³„ì† (ì¹´ë“œ ë½‘ê¸°)</button>
            <button id="stop-btn" class="btn">íƒí—˜ ì¤‘ë‹¨ (ì ìˆ˜ íšë“)</button>
        </section>
    </div>

    <!-- ê²Œì„ ì‹œì‘/ì¢…ë£Œ ëª¨ë‹¬ -->
    <div id="game-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-title">ê²Œì„ ì‹œì‘</h2>
            <p id="modal-text">ê³ ëŒ€ ìœ ì ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ìœ ë¬¼ì„ ì°¾ì•„ ì ìˆ˜ë¥¼ ì–»ìœ¼ì„¸ìš”. í•˜ì§€ë§Œ ì €ì£¼ë¥¼ ì¡°ì‹¬í•˜ì„¸ìš”! ì €ì£¼ê°€ 5 ì´ìƒ ìŒ“ì´ë©´ ëª¨ë“  ê²ƒì„ ìƒìŠµë‹ˆë‹¤.</p>
            <p id="modal-final-score"></p>
            <button id="modal-btn" class="btn">íƒí—˜ ì‹œì‘!</button>
        </div>
    </div>


    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM ìš”ì†Œ ---
            const totalScoreEl = document.getElementById('total-score');
            const turnScoreEl = document.getElementById('turn-score');
            const curseLevelEl = document.getElementById('curse-level');
            const deckPileEl = document.getElementById('deck-pile');
            const explorationAreaEl = document.getElementById('exploration-area');
            const messageTextEl = document.getElementById('message-text');
            const exploreBtn = document.getElementById('explore-btn');
            const stopBtn = document.getElementById('stop-btn');
            
            const gameModal = document.getElementById('game-modal');
            const modalTitle = document.getElementById('modal-title');
            const modalText = document.getElementById('modal-text');
            const modalFinalScore = document.getElementById('modal-final-score');
            const modalBtn = document.getElementById('modal-btn');

            // --- ê²Œì„ ì„¤ì • ---
            const CURSE_LIMIT = 5;
            const CARD_DEFINITIONS = {
                relics: [
                    { name: 'ë‚¡ì€ ë™ì „', value: 1, count: 5 },
                    { name: 'ë³´ì„ ë°•íŒ ë‹¨ê²€', value: 2, count: 5 },
                    { name: 'í™©ê¸ˆ ì”', value: 3, count: 4 },
                    { name: 'ìˆ˜ì • í•´ê³¨', value: 4, count: 3 },
                    { name: 'ê³ ëŒ€ ì™•ê´€', value: 5, count: 2 },
                    { name: 'í˜„ìì˜ ëŒ', value: 7, count: 1 },
                ],
                curses: [
                    { name: 'ë°•ì¥ ë–¼', value: 1, count: 5 },
                    { name: 'í•¨ì •', value: 1, count: 5 },
                ]
            };

            // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
            let mainDeck = [];
            let totalScore = 0;
            let turnScore = 0;
            let curseLevel = 0;
            let turnCards = []; // ì´ë²ˆ í„´ì— ë½‘ì€ ì¹´ë“œë“¤

            // --- ê²Œì„ ë¡œì§ í•¨ìˆ˜ ---

            function createDeck() {
                const deck = [];
                CARD_DEFINITIONS.relics.forEach(r => {
                    for (let i = 0; i < r.count; i++) {
                        deck.push({ type: 'relic', name: r.name, value: r.value });
                    }
                });
                CARD_DEFINITIONS.curses.forEach(c => {
                    for (let i = 0; i < c.count; i++) {
                        deck.push({ type: 'curse', name: c.name, value: c.value });
                    }
                });
                return deck;
            }

            function shuffleDeck(deck) {
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
            }

            function startGame() {
                mainDeck = createDeck();
                shuffleDeck(mainDeck);
                
                totalScore = 0;
                turnScore = 0;
                curseLevel = 0;
                turnCards = [];
                
                updateUI();
                explorationAreaEl.innerHTML = '';
                messageTextEl.textContent = 'ìƒˆë¡œìš´ íƒí—˜ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.';
                exploreBtn.disabled = false;
                stopBtn.disabled = false;
                gameModal.style.display = 'none';
            }

            function explore() {
                if (mainDeck.length === 0) {
                    messageTextEl.textContent = 'ë” ì´ìƒ íƒí—˜í•  ê³³ì´ ì—†ìŠµë‹ˆë‹¤!';
                    stopExploration(true); // ë±ì´ ë‹¤ ë–¨ì–´ì¡Œìœ¼ë‹ˆ ê°•ì œ ì¢…ë£Œ
                    return;
                }

                const card = mainDeck.pop();
                turnCards.push(card);
                
                displayCard(card);

                if (card.type === 'relic') {
                    turnScore += card.value;
                    messageTextEl.textContent = `[${card.name}] ë°œê²¬! (+${card.value}ì )`;
                } else {
                    curseLevel += card.value;
                    messageTextEl.textContent = `[${card.name}]! ì €ì£¼ê°€ ìŒ“ì…ë‹ˆë‹¤. (+${card.value} ì €ì£¼)`;
                }

                updateUI();
                checkGameOver();
            }

            function stopExploration(isForced = false) {
                if (turnScore > 0 && !isForced) {
                    totalScore += turnScore;
                    messageTextEl.textContent = `${turnScore}ì ì„ íšë“í•˜ê³  ì•ˆì „í•˜ê²Œ ë³µê·€í–ˆìŠµë‹ˆë‹¤.`;
                } else if (isForced) {
                     messageTextEl.textContent = `ì €ì£¼ì— íœ©ì‹¸ì—¬ íƒí—˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤!`;
                }
                
                // í„´ ì´ˆê¸°í™”
                turnScore = 0;
                curseLevel = 0;
                turnCards = [];
                explorationAreaEl.innerHTML = '';
                
                if (mainDeck.length === 0) {
                    showEndGameModal(true); // ê²Œì„ ìŠ¹ë¦¬
                }
                
                updateUI();
            }
            
            function checkGameOver() {
                if (curseLevel >= CURSE_LIMIT) {
                    exploreBtn.disabled = true;
                    stopBtn.disabled = true;
                    messageTextEl.textContent = `ì €ì£¼ê°€ ${CURSE_LIMIT}ì— ë„ë‹¬í–ˆìŠµë‹ˆë‹¤! íƒí—˜ ì‹¤íŒ¨!`;
                    
                    // ì‹¤íŒ¨ ì• ë‹ˆë©”ì´ì…˜
                    explorationAreaEl.classList.add('shake');
                    setTimeout(() => {
                        showEndGameModal(false); // ê²Œì„ íŒ¨ë°°
                        explorationAreaEl.classList.remove('shake');
                    }, 1000);
                }
            }
            
            function showStartModal() {
                gameModal.style.display = 'flex';
                modalTitle.textContent = "ê²Œì„ ì‹œì‘";
                modalText.textContent = "ê³ ëŒ€ ìœ ì ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤. ìœ ë¬¼ì„ ì°¾ì•„ ì ìˆ˜ë¥¼ ì–»ìœ¼ì„¸ìš”. í•˜ì§€ë§Œ ì €ì£¼ë¥¼ ì¡°ì‹¬í•˜ì„¸ìš”! ì €ì£¼ê°€ 5 ì´ìƒ ìŒ“ì´ë©´ ëª¨ë“  ê²ƒì„ ìƒìŠµë‹ˆë‹¤.";
                modalFinalScore.textContent = '';
                modalBtn.textContent = "íƒí—˜ ì‹œì‘!";
                modalBtn.onclick = startGame;
            }
            
            function showEndGameModal(isWin) {
                gameModal.style.display = 'flex';
                if (isWin) {
                    modalTitle.textContent = "íƒí—˜ ì„±ê³µ!";
                    modalText.textContent = "ëª¨ë“  ìœ ì ì„ íƒí—˜í•˜ê³  ë¬´ì‚¬íˆ ê·€í™˜í–ˆìŠµë‹ˆë‹¤!";
                } else {
                    modalTitle.textContent = "íƒí—˜ ì‹¤íŒ¨!";
                    modalText.textContent = "ì €ì£¼ì˜ í˜ì„ ì´ê¸°ì§€ ëª»í•˜ê³  ì“°ëŸ¬ì¡ŒìŠµë‹ˆë‹¤...";
                }
                modalFinalScore.textContent = `ìµœì¢… ì ìˆ˜: ${totalScore}`;
                modalBtn.textContent = "ë‹¤ì‹œ í”Œë ˆì´";
                modalBtn.onclick = startGame;
            }

            // --- UI ì—…ë°ì´íŠ¸ í•¨ìˆ˜ ---
            function updateUI() {
                totalScoreEl.textContent = totalScore;
                turnScoreEl.textContent = turnScore;
                curseLevelEl.textContent = `${curseLevel} / ${CURSE_LIMIT}`;
                deckPileEl.dataset.count = mainDeck.length;

                if (curseLevel >= CURSE_LIMIT) {
                    curseLevelEl.style.color = '#d93a3a';
                    curseLevelEl.style.fontWeight = 'bold';
                } else {
                    curseLevelEl.style.color = 'var(--color-text)';
                    curseLevelEl.style.fontWeight = 'normal';
                }
            }

            function displayCard(card) {
                const cardEl = document.createElement('div');
                cardEl.classList.add('card', card.type);
                
                const nameEl = document.createElement('span');
                nameEl.textContent = card.name;
                
                const valueEl = document.createElement('span');
                valueEl.classList.add('value');
                valueEl.textContent = card.type === 'relic' ? `+${card.value}` : `+${card.value}ğŸ’€`;
                
                cardEl.appendChild(nameEl);
                cardEl.appendChild(valueEl);
                
                explorationAreaEl.appendChild(cardEl);
                explorationAreaEl.scrollTop = explorationAreaEl.scrollHeight;
            }

            // --- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ---
            exploreBtn.addEventListener('click', explore);
            stopBtn.addEventListener('click', () => stopExploration(false));
            deckPileEl.addEventListener('click', explore);

            // --- ê²Œì„ ì‹œì‘ ---
            showStartModal();
        });
    </script>
</body>
</html>
